<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title>个人中心</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/bootstrap-dialog/css/bootstrap-dialog.min.css">
    <link rel="stylesheet" href="/css/animate.min.css">
    <link rel="stylesheet" href="../font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../vivify/vivify.min.css">
    <link rel="stylesheet" href="/css/left-right.css">
    <link rel="stylesheet" href="/css/user-center-information.css">
    <link rel="stylesheet" href="/css/user-center-my-fans-list.css">
    <link rel="stylesheet" href="/css/user-center-my-following-list.css">
    <link rel="stylesheet" href="/css/user-center-my-avatar.css">
    <link rel="stylesheet" href="/css/blog-list-item.css">
    <link rel="stylesheet" href="/css/default.css">
    <style type="text/css">
        .collection-box {
            border-radius: 5px;
            background: #fff;
            padding: 15px;
        }

        .head-title {
            border-right: 1px solid #e6e6e6;
            list-style: none;
            position: relative;
            margin: 0;
            padding-left: 0;
            background-color: #fff;
            border-right: none;
            border-bottom: 1px solid #e6e6e6;
        }

        .title-text {
            height: 26px;
            line-height: 26px;
            color: #00a1d6;
            font-weight: bold;
            font-size: 16px;
            border: none;
            cursor: default;

            background-color: #fff !important;
            border-bottom-color: transparent;
        }
    </style>

    <!-- HTML5 shim 和 Respond.js 是为了让 IE8 支持 HTML5 元素和媒体查询（media queries）功能 -->
    <!-- 警告：通过 file:// 协议（就是直接将 html 页面拖拽到浏览器中）访问页面时 Respond.js 不起作用 -->
    <!--[if lt IE 9]>
    <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>

    <![endif]-->
</head>
<body class="default-background">
<div class="container-fluid" id="app" style="margin-top: 80px;">
    <div class="row">
        <div class="col-md-2 col-lg-2 col-sm-2"></div>
        <div class="col-md-1 col-lg-1 col-sm-1 container-left">
            <div>
                <!-- Nav tabs -->
                <ul class="nav nav-tabs" role="tablist">
                    <li role="presentation" class="active"><a href="#information" role="tab" data-toggle="tab">个人资料</a>
                    </li>
                    <li role="presentation"><a href="#my-fans-list" role="tab" data-toggle="tab">粉丝</a></li>
                    <li role="presentation"><a href="#my-following" role="tab" data-toggle="tab">关注</a></li>
                    <li role="presentation"><a href="#my-collection" role="tab" data-toggle="tab">收藏</a></li>
                    <li role="presentation"><a href="#my-blog" role="tab" data-toggle="tab">博客</a></li>
                </ul>
            </div>
        </div>
        <div class="col-md-7 col-lg-7 col-sm-7 container-right">
            <!-- Tab panes -->
            <div class="tab-content" style="min-width: 820px;">
                <div role="tabpanel" class="tab-pane active" id="information">
                    <div class="general-info pb-8 vivify pullUp">
                        <div class="general-info-t">
                            <!--                                头像部分-->
                            <div class="general-info-avatar">
                                <img>
                            </div>
                            <!--                                信息部分-->
                            <div class="general-info-t-info">
                                <div class="profile-name-info">
                                    <div class="person-name nickname">NICKNAME</div>
                                    <span class="person-code-age">码龄0年</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="base-info" class="base-info">
                        <!--                        <div class="base-info-head">基本信息</div>-->
                        <div class="security-right-title">
                            <span class="security-right-title-icon"></span>
                            <span class="security-right-title-text">我的信息</span> <!---->
                        </div>
                        <div class="base-info-content">
                            <div class="base-info-content-show vivify fadeIn">
                                <ul>
                                    <li>
                                        <div class="content-show-l">用户昵称</div>
                                        <div class="content-show-r nickname">-</div>
                                    </li>
                                    <li>
                                        <div class="content-show-l">用户邮箱</div>
                                        <div class="content-show-r email">-</div>
                                    </li>
                                    <li>
                                        <div class="content-show-l">真实姓名</div>
                                        <div class="content-show-r real-name">-</div>
                                    </li>
                                    <li>
                                        <div class="content-show-l"><span>性</span><span>别</span></div>
                                        <div class="content-show-r sex">-</div>
                                    </li>
                                    <li>
                                        <div class="content-show-l">个人简介</div>
                                        <div class="content-show-r self-introduction">-</div>
                                    </li>
                                    <li>
                                        <div class="content-show-l">所在地区</div>
                                        <div class="content-show-r city">-</div>
                                    </li>
                                    <li>
                                        <div class="content-show-l">出生日期</div>
                                        <div class="content-show-r birthday">-</div>
                                    </li>
                                    <li>
                                        <div class="content-show-l">开始工作</div>
                                        <div class="content-show-r">-</div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div role="tabpanel" class="tab-pane" id="my-fans-list">
                    <div class="fans_list">
                        <div class="my-fans-list-title">
                            <span class="my-fans-list-title-icon"></span>
                            <span class="my-fans-list-title-text">粉丝</span> <!---->
                        </div>
                    </div>
                </div>
                <div role="tabpanel" class="tab-pane" id="my-following">
                    <div class="following_list">
                        <div class="my-following-list-title">
                            <span class="my-following-list-title-icon"></span>
                            <span class="my-following-list-title-text">关注</span> <!---->
                        </div>
                    </div>
                </div>
                <div role="tabpanel" class="tab-pane" id="my-collection">
                    <div class="collection-box">
                        <div role="menubar" class="head-title">
                            <span class="title-text">收藏列表</span>
                        </div>
                        <div class="collection-list">

                        </div>
                    </div>
                </div>
                <div role="tabpanel" class="tab-pane" id="my-blog">
                    <div class="collection-box">
                        <div role="menubar" class="head-title">
                            <span class="title-text">博客列表</span>
                        </div>
                        <div class="blog-list">

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-2 col-lg-2 col-sm-2"></div>
    </div>
</div>

<!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
<script src=" /static/bootstrap/js/jquery-1.12.4.min.js"></script>
<!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
<script src="/static/bootstrap/js/bootstrap.min.js"></script>
<script src="/static/bootstrap-dialog/js/bootstrap-dialog.min.js"></script>
<script src="/js/user-center-information.js"></script>
<script src="/js/default.js"></script>
<script src="/js/jquery.cookie.min.js"></script>
<script src="/js/user-center-my-avatar.js"></script>
<script type="text/javascript">
    //正则表达式
    const psw_reg = /^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{8,20}$/;

    // 生成粉丝列表条目
    function make_fans_list_item(data) {
        return `
             <div class="fans_list_item vivify pullDown">
                <div class="fans_list_item_content">
                    <div class="fans_list_item_left">
                        <a href='/view/user-space.html?id=${data['fans_id']}' target="_blank">
                            <img src='/getAvatar?id=${data['fans_id']}' alt="" class="fans_avatar">
                        </a>
                        <div class="fans_content">
                            <div class="fans_title">
                                <a href='/view/user-space.html?id=${data['fans_id']}' target="_blank">
                                    <div class="fans-name">${data['nickname']}</div>
                                </a>
                            </div>
                            <div class="desc">
                            ${data['self_introduction']}
                            </div>
                        </div>
                    </div>
                </div>
            </div>`;
    }

    // 生成关注列表条目
    function make_following_list_item(data) {
        return `
             <div class="following_list_item vivify pullDown">
                <div class="following_list_item_content">
                    <div class="following_list_item_left">
                        <a href='/view/user-space.html?id=${data['following_id']}' target="_blank">
                            <img src='/getAvatar?id=${data['following_id']}' alt="" class="following_avatar">
                        </a>
                        <div class="following_content">
                            <div class="following_title">
                                <a href='/view/user-space.html?id=${data['following_id']}' target="_blank">
                                    <div class="following-name">${data['nickname']}</div>
                                </a>
                            </div>
                            <div class="desc">
                                ${data['self_introduction']}
                            </div>
                        </div>
                    </div>
                </div>
            </div>`;
    }

    // 控件生成器（博客列表条目）
    function make_blog_list_item(data) {
        if (data == null) return null;
        return `
        <li class="consoleHome-listData" blog_id=${data['blog_id']}>
            <div class="consoleHome-listData-left">
                <span class="consoleHome-listData-mark">博客</span>
                <div class="consoleHome-listData-desc">
                    <a href=${data['view_url']} target="_blank">
                        <p class="title" title=${data['title']}>${data['title']}</p>
                        <p title=${$.str_code(data['pre_text'])}>${$.str_code(data['pre_text'])}</p>
                    </a>
                </div>
            </div>

            <div>
                <ul class="consoleHome-listData-num">
                    <li>
                        <p class="listNum">${data['comment_count']}</p>
                        <p>评论数</p>
                    </li>
                    <li><p class="listNum">${data['like_count']}</p>
                        <p>点赞数</p></li>
                    <li><p class="listNum">${data['collection_count']}</p>
                        <p>收藏数</p></li>
                </ul>
            </div>
        </li>
        `;
    }

    $(function () {
        let id = $.get_url_param('id');
        $('.my-avatar').attr('src', '/getAvatar?id=' + id);
        // 获取用户信息
        $('.general-info-avatar img').attr('src', '/getAvatar?id=' + id);
        $.post('/getUserInfo', {id: id}, function (res) {
            let data = res['data']['data'];
            if (data != null) {
                // 加载个人信息展示区资料
                // 计算码龄
                let register_time = new Date(data['register_time']);
                let now = new Date();
                let code_age = (now.getTime() - register_time.getTime()) / (1000 * 60 * 60 * 24 * 365);
                $('.person-code-age').text('码龄' + Math.ceil(code_age) + '年');
                $('.nickname').text(data['nickname']);
                // 设置标题
                document.title = data['nickname'];
                $('.email').text(data['email']);
                $('.city').text(data['city']);
                $('.real-name').text(data['real_name']);
                let sex = (data['sex']) % 3;
                $('.sex').text(sex === 0 ? '未知' : sex === 1 ? '男' : '女');
                $('.self-introduction').text(data['self_introduction']);
                $('.birthday').text(data['birthday']);
            }
        })
        // 加载粉丝列表
        $.post('/getFansList', {id: id}, function (res) {
            let data = res['data']['data'];
            if (data != null) {
                // 向粉丝列表里面添加粉丝信息
                $.push_back_controller($('.fans_list'), make_fans_list_item, data);
            }
        });
        // 加载关注列表
        $.post('/getFollowingList', {id: id}, function (res) {
            let data = res['data']['data'];
            if (data != null) {
                // 向关注列表里面添加关注信息
                $.push_back_controller($('.following_list'), make_following_list_item, data);
            }
        });
        // 加载收藏列表
        $.get('/getCollectionBlogInfo', {id: id}, {page: 1, size: 30}, function (res) {
            let view_url = res['data']['view_url'];
            let data = res['data']['data'];
            if (data != null && data.length > 0) {
                for (let i = 0; i < data.length; i++) {
                    data[i]['view_url'] = view_url + '?blog_id=' + data[i]['blog_id'];
                }
                $.push_back_controller($('.collection-list'), make_blog_list_item, data);
            }
        });
        // 加载博客列表
        $.get('/getUserBlogInfo', {size: 10, page: 1, id: id}, function (res) {
            let view_url = res['data']['view_url'];
            let data = res['data']['data'];
            if (data != null && data.length > 0) {
                for (let i = 0; i < data.length; i++) {
                    data[i]['view_url'] = view_url + '?blog_id=' + data[i]['blog_id'];
                }
                $.push_back_controller($('.blog-list'), make_blog_list_item, data);
            }
        });
    });
</script>
</body>
</html>
